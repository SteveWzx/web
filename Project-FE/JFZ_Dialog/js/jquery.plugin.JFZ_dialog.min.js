(function($){$.JFZ_Dialog=function(){var defaults={animation_speed_hide:250,animation_speed_show:0,auto_close:false,buttons:true,custom_class:false,keyboard:true,max_height:0,message:"",modal:true,overlay_close:false,overlay_opacity:0.3,position:"center",reposition_speed:100,source:false,title:"",type:"information",vcenter_short_message:true,width:0,onClose:null,stopScroll:true};var plugin=this;plugin.settings={};options={};if(typeof arguments[0]=="string"){options.message=arguments[0]}if(typeof arguments[0]=="object"||typeof arguments[1]=="object"){options=$.extend(options,(typeof arguments[0]=="object"?arguments[0]:arguments[1]))}plugin.init=function(){plugin.settings=$.extend({},defaults,options);plugin.isIE6=(browser.name=="explorer"&&browser.version==6)||false;if(plugin.settings.stopScroll){_stopScroll()}if(plugin.settings.modal){plugin.overlay=jQuery("<div>",{"class":"JFZDialogOverlay"}).css({position:(plugin.isIE6?"absolute":"fixed"),left:0,top:0,opacity:plugin.settings.overlay_opacity});if(plugin.settings.overlay_close){plugin.overlay.bind("click",function(){plugin.close()})}plugin.overlay.appendTo("body")}plugin.dialog=jQuery("<div>",{"class":"JFZDialog"+(plugin.settings.custom_class?" "+plugin.settings.custom_class:"")}).css({position:(plugin.isIE6?"absolute":"fixed"),left:0,top:0,visibility:"hidden"});if(!plugin.settings.buttons&&plugin.settings.auto_close){plugin.dialog.attr("id","JFZ_Dialog_"+Math.floor(Math.random()*9999999))}var tmp=parseInt(plugin.settings.width);if(!isNaN(tmp)&&tmp==plugin.settings.width&&tmp.toString()==plugin.settings.width.toString()&&tmp>0){plugin.dialog.css({width:plugin.settings.width})}if(plugin.settings.title){jQuery("<h3>",{"class":"JFZDialog_Title",id:"JFZDialog_Title"}).html(plugin.settings.title).appendTo(plugin.dialog);jQuery("<i>",{"class":"JFZDialog_Title_Close",id:"JFZDialog_Title_Close"}).appendTo(plugin.dialog);$(".JFZDialog_Title_Close").live("click",function(e){plugin.close()})}var body_container=jQuery("<div>",{"class":"JFZDialog_BodyOuter"+(!plugin.settings.title?" JFZDialog_NoTitle":"")+(!get_buttons()?" JFZDialog_NoButtons":"")}).appendTo(plugin.dialog);plugin.message=jQuery("<div>",{"class":"JFZDialog_Body"+(get_type()!=""?" JFZDialog_Icon JFZDialog_"+get_type():"")});if(plugin.settings.max_height>0){plugin.message.css("max-height",plugin.settings.max_height);if(plugin.isIE6){plugin.message.attr("style","height: expression(this.scrollHeight > "+plugin.settings.max_height+' ? "'+plugin.settings.max_height+'px" : "85px")')}}if(plugin.settings.vcenter_short_message){jQuery("<div>").html(plugin.settings.message).appendTo(plugin.message)}else{plugin.message.html(plugin.settings.message)}if(plugin.settings.source&&typeof plugin.settings.source=="object"){var canvas=(plugin.settings.vcenter_short_message?$("div:first",plugin.message):plugin.message);for(var type in plugin.settings.source){switch(type){case"ajax":var ajax_options=typeof plugin.settings.source[type]=="string"?{url:plugin.settings.source[type]}:plugin.settings.source[type],preloader=jQuery("<div>").attr("class","JFZDialog_Preloader").appendTo(canvas);ajax_options.success=function(result){preloader.remove();canvas.append(result);draw(false)};$.ajax(ajax_options);break;case"iframe":var default_options={width:"100%",height:"100%",marginheight:"0",marginwidth:"0",frameborder:"0"};iframe_options=$.extend(default_options,typeof plugin.settings.source[type]=="string"?{src:plugin.settings.source[type]}:plugin.settings.source[type]);canvas.append(jQuery("<iframe>").attr(iframe_options));break;case"inline":canvas.append(plugin.settings.source[type]);break}}}plugin.message.appendTo(body_container);var buttons=get_buttons();if(buttons){var button_bar=jQuery("<div>",{"class":"JFZDialog_Buttons"}).appendTo(plugin.dialog);$.each(buttons,function(index,value){var button=jQuery("<a>",{href:"javascript:void(0)","class":"JFZDialog_Button"+index});if($.isPlainObject(value)){button.html(value.caption)}else{button.html(value)}button.bind("click",function(){if(undefined!=value.callback){value.callback(plugin.dialog)}plugin.close(undefined!=value.caption?value.caption:value)});button.appendTo(button_bar)});jQuery("<div>",{style:"clear:both"}).appendTo(button_bar)}plugin.dialog.appendTo("body");$(window).bind("resize",draw);if(plugin.settings.keyboard){$(document).bind("keyup",_keyup)}if(plugin.isIE6){$(window).bind("scroll",_scroll)}if(plugin.settings.auto_close!==false){plugin.dialog.bind("click",function(e){clearTimeout(plugin.timeout);plugin.close()});plugin.timeout=setTimeout(plugin.close,plugin.settings.auto_close)}draw(false);return plugin};plugin.close=function(caption){if(plugin.settings.keyboard){$(document).unbind("keyup",_keyup)}if(plugin.isIE6){$(window).unbind("scroll",_scroll)}$(window).unbind("resize",draw);if(plugin.overlay){plugin.overlay.animate({opacity:0},plugin.settings.animation_speed_hide,function(){plugin.overlay.remove()})}plugin.dialog.animate({height:0,opacity:0},plugin.settings.animation_speed_hide,function(){plugin.dialog.remove();if(plugin.settings.onClose&&typeof plugin.settings.onClose=="function"){plugin.settings.onClose(undefined!=caption?caption:"")}})};var draw=function(){var viewport_width=$(window).width(),viewport_height=$(window).height(),dialog_width=plugin.dialog.width(),dialog_height=plugin.dialog.height(),values={left:0,top:0,right:viewport_width-dialog_width,bottom:viewport_height-dialog_height,center:(viewport_width-dialog_width)/2,middle:(viewport_height-dialog_height)/2};plugin.dialog_left=undefined;plugin.dialog_top=undefined;if(plugin.settings.modal){plugin.overlay.css({width:viewport_width,height:viewport_height})}if($.isArray(plugin.settings.position)&&plugin.settings.position.length==2&&typeof plugin.settings.position[0]=="string"&&plugin.settings.position[0].match(/^(left|right|center)[\s0-9\+\-]*$/)&&typeof plugin.settings.position[1]=="string"&&plugin.settings.position[1].match(/^(top|bottom|middle)[\s0-9\+\-]*$/)){plugin.settings.position[0]=plugin.settings.position[0].toLowerCase();plugin.settings.position[1]=plugin.settings.position[1].toLowerCase();$.each(values,function(index,value){for(var i=0;i<2;i++){var tmp=plugin.settings.position[i].replace(index,value);if(tmp!=plugin.settings.position[i]){if(i==0){plugin.dialog_left=eval(tmp)}else{plugin.dialog_top=eval(tmp)}}}})}if(undefined==plugin.dialog_left||undefined==plugin.dialog_top){plugin.dialog_left=values.center;plugin.dialog_top=values.middle}if(plugin.settings.vcenter_short_message){var message=plugin.message.find("div:first"),message_height=message.height(),container_height=plugin.message.height();if(message_height<container_height){message.css({"padding-top":(container_height-message_height)/2})}}if((typeof arguments[0]=="boolean"&&arguments[0]===false)||plugin.settings.reposition_speed==0){plugin.dialog.css({left:plugin.dialog_left,top:plugin.dialog_top,visibility:"visible",opacity:0}).animate({opacity:1},plugin.settings.animation_speed_show)}else{plugin.dialog.stop(true);plugin.dialog.css("visibility","visible").animate({left:plugin.dialog_left,top:plugin.dialog_top},plugin.settings.reposition_speed)}plugin.dialog.find("a[class^=JFZDialog_Button]:first").focus();if(plugin.isIE6){setTimeout(emulate_fixed_position,500)}};var emulate_fixed_position=function(){var scroll_top=$(window).scrollTop(),scroll_left=$(window).scrollLeft();if(plugin.settings.modal){plugin.overlay.css({top:scroll_top,left:scroll_left})}plugin.dialog.css({left:plugin.dialog_left+scroll_left,top:plugin.dialog_top+scroll_top})};var get_buttons=function(){if(plugin.settings.buttons!==true&&!$.isArray(plugin.settings.buttons)){return false}if(plugin.settings.buttons===true){switch(plugin.settings.type){case"question":plugin.settings.buttons=["Yes","No"];break;default:plugin.settings.buttons=["Ok"]}}return plugin.settings.buttons.reverse()};var get_type=function(){switch(plugin.settings.type){case"confirmation":case"error":case"information":case"question":case"warning":return plugin.settings.type.charAt(0).toUpperCase()+plugin.settings.type.slice(1).toLowerCase();break;default:return false}};var _keyup=function(e){if(e.which==27){plugin.close()}return true};var _scroll=function(){emulate_fixed_position()};var browser={init:function(){this.name=this.searchString(this.dataBrowser)||"";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||""},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1){return data[i].identity}}else{if(dataProp){return data[i].identity}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"MSIE",identity:"explorer",versionSearch:"MSIE"}]};var _stopScroll=function(){$("body")[0].onmousewheel=function(e){e=e||window.event;if(navigator.userAgent.toLowerCase().indexOf("msie")>=0){event.returnValue=false}else{e.preventDefault()}};if(navigator.userAgent.toLowerCase().indexOf("firefox")>=0){addEventListener("DOMMouseScroll",function(e){var obj=e.target;var onmousewheel;while(obj){onmousewheel=obj.getAttribute("onmousewheel")||obj.onmousewheel;if(onmousewheel){break}if(obj.tagName=="BODY"){break}obj=obj.parentNode}if(onmousewheel){if(e.preventDefault){e.preventDefault()}e.returnValue=false;if(typeof obj.onmousewheel!="function"){eval("window._tmpFun = function(event){"+onmousewheel+"}");obj.onmousewheel=window._tmpFun;window._tmpFun=null}setTimeout(function(){obj.onmousewheel(e)},1)}},false)}};browser.init();return plugin.init()}})(jQuery);(function($){var isMouseDown=false;var currentElement=null;var dropCallbacks={};var dragCallbacks={};var bubblings={};var dragStatus={};var lastMouseX;var lastMouseY;var lastElemTop;var lastElemLeft;var holdingHandler=false;$.getMousePosition=function(e){var posx=0;var posy=0;if(!e){var e=window.event}if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY}else{if(e.clientX||e.clientY){posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return{x:posx,y:posy}};$.updatePosition=function(e){var pos=$.getMousePosition(e);var spanX=(pos.x-lastMouseX);var spanY=(pos.y-lastMouseY);$(currentElement).css("top",(lastElemTop+spanY));$(currentElement).css("left",(lastElemLeft+spanX))};$(document).mousemove(function(e){if(isMouseDown&&(dragStatus[currentElement.id]!="false")){$.updatePosition(e);if(dragCallbacks[currentElement.id]!=undefined){dragCallbacks[currentElement.id](e,currentElement)}return false}});$(document).mouseup(function(e){if(isMouseDown&&dragStatus[currentElement.id]!="false"){isMouseDown=false;if(dropCallbacks[currentElement.id]!=undefined){dropCallbacks[currentElement.id](e,currentElement)}return false}});$.fn.ondrag=function(callback){return this.each(function(){dragCallbacks[this.id]=callback})};$.fn.ondrop=function(callback){return this.each(function(){dropCallbacks[this.id]=callback})};$.fn.dragOff=function(){return this.each(function(){dragStatus[this.id]="off"})};$.fn.dragOn=function(){return this.each(function(){dragStatus[this.id]="on"})};$.fn.setHandler=function(handlerId){return this.each(function(){var draggable=this;bubblings[this.id]=true;$(draggable).css("cursor","");dragStatus[draggable.id]="handler";$("#"+handlerId).css("cursor","move");$("#"+handlerId).mousedown(function(e){$("#"+handlerId).css("cursor","move");holdingHandler=true;$(draggable).trigger("mousedown",e)});$("#"+handlerId).mouseup(function(e){holdingHandler=false})})};$.fn.easydrag=function(allowBubbling){return this.each(function(){if(undefined==this.id||!this.id.length){this.id="easydrag_"+(new Date().getTime())}bubblings[this.id]=allowBubbling?true:false;dragStatus[this.id]="on";$(this).css("cursor","move");$(this).mousedown(function(e){if((dragStatus[this.id]=="off")||(dragStatus[this.id]=="handler"&&!holdingHandler)){return bubblings[this.id]}$(this).css("z-index",parseInt(new Date().getTime()/1000));isMouseDown=true;currentElement=this;var pos=$.getMousePosition(e);lastMouseX=pos.x;lastMouseY=pos.y;lastElemTop=this.offsetTop;lastElemLeft=this.offsetLeft;$.updatePosition(e);return bubblings[this.id]})})}})(jQuery);