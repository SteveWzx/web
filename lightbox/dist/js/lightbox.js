!function(i){var t=function(t){var s=this;this.settings={speed:500},i.extend(this.settings,t||{}),this.popupMask=i('<div id="G-lightbox-mask">'),this.popupWin=i('<div id="G-lightbox-popup">'),this.bodyNode=i(document.body),this.renderDOM(),this.picViewArea=this.popupWin.find("div.lightbox-pic-view"),this.popupPic=this.popupWin.find("img.lightbox-image"),this.picCaptionArea=this.popupWin.find("div.lightbox-pic-caption"),this.nextBtn=this.popupWin.find("span.lightbox-next-btn"),this.prevBtn=this.popupWin.find("span.lightbox-prev-btn"),this.captionText=this.popupWin.find("p.lightbox-pic-desc"),this.currentIndex=this.popupWin.find("span.lightbox-of-index"),this.closeBtn=this.popupWin.find("span.lightbox-btn-close"),this.groupName=null,this.groupData=[],this.bodyNode.delegate(".js-lightbox,*[data-role=lightbox]","click",function(t){t.stopPropagation();var a=i(this).attr("data-group");a!=s.groupName&&(s.groupName=a,s.getGroup()),s.initPopup(i(this))}),this.popupMask.click(function(){i(this).fadeOut(),s.popupWin.fadeOut(),s.clear=!1}),this.closeBtn.click(function(){s.popupMask.fadeOut(),s.popupWin.fadeOut(),s.clear=!1}),this.flag=!0,this.nextBtn.hover(function(){!i(this).hasClass("disabled")&&s.groupData.length>1&&i(this).addClass("lightbox-next-btn-show")},function(){!i(this).hasClass("disabled")&&s.groupData.length>1&&i(this).removeClass("lightbox-next-btn-show")}).click(function(t){!i(this).hasClass("disabled")&&s.flag&&(s.flag=!1,t.stopPropagation(),s["goto"]("next"))}),this.prevBtn.hover(function(){!i(this).hasClass("disabled")&&s.groupData.length>1&&i(this).addClass("lightbox-prev-btn-show")},function(){!i(this).hasClass("disabled")&&s.groupData.length>1&&i(this).removeClass("lightbox-prev-btn-show")}).click(function(t){!i(this).hasClass("disabled")&&s.flag&&(s.flag=!1,t.stopPropagation(),s["goto"]("prev"))});var a=null;i(window).resize(function(){s.clear&&(window.clearTimeout(a),a=window.setTimeout(function(){s.loadPicSize(s.groupData[s.index].src)},500))}).keyup(function(i){var t=i.which;s.clear&&(38==t||37==t?s.prevBtn.click():(40==t||39==t)&&s.nextBtn.click())})};t.prototype={"goto":function(i){if("next"===i){this.index++,this.index>=this.groupData.length-1&&this.nextBtn.addClass("disabled").removeClass("lightbox-next-btn-show"),0!==this.index&&this.prevBtn.removeClass("disabled");var t=this.groupData[this.index].src;this.loadPicSize(t)}else if("prev"===i){this.index--,this.index<=0&&this.prevBtn.addClass("disabled").removeClass("lightbox-prev-btn-show"),this.index!=this.groupData.length-1&&this.nextBtn.removeClass("disabled");var t=this.groupData[this.index].src;this.loadPicSize(t)}},loadPicSize:function(i){var t=this;t.popupPic.css({width:"auto",height:"auto"}).hide(),this.picCaptionArea.hide(),this.preLoadImg(i,function(){t.popupPic.attr("src",i);var s=t.popupPic.width(),a=t.popupPic.height();console.log(s+":"+a),t.changePic(s,a)})},changePic:function(t,s){var a=this,n=i(window).width(),e=i(window).height(),o=Math.min(n/(t+10),e/(s+10),1);t*=o,s*=o,this.picViewArea.animate({width:t-10,height:s-10},a.settings.speed),this.popupWin.animate({width:t,height:s,marginLeft:-(t/2),top:(e-s)/2},a.settings.speed,function(){a.popupPic.css({width:t-10,height:s-10}).fadeIn(),a.picCaptionArea.fadeIn(),a.flag=!0,a.clear=!0}),console.log(this.index),this.captionText.text(this.groupData[this.index].caption),this.currentIndex.text("当前索引："+(this.index+1)+" of "+this.groupData.length)},preLoadImg:function(i,t){var s=new Image;window.ActiveXObject?s.onreadystatechange=function(){"complete"==this.readyState&&t()}:s.onload=function(){t()},s.src=i},showMaskAndPoupup:function(t,s){var a=this;this.popupPic.hide(),this.picCaptionArea.hide(),this.popupMask.css({opacity:a.settings.maskOpacity}),this.popupMask.fadeIn();var n=i(window).width(),e=i(window).height();this.picViewArea.css({width:n/2,height:e/2}),this.popupWin.fadeIn();var o=e/2+10;this.popupWin.css({width:n/2+10,height:e/2+10,marginLeft:-(n/2+10)/2,top:-o}).animate({top:(e-o)/2},a.settings.speed,function(){a.loadPicSize(t)}),this.index=this.getIndexOf(s);var h=this.groupData.length;h>1&&(0===this.index?(this.prevBtn.addClass("disabled"),this.nextBtn.removeClass("disabled")):this.index===h-1?(this.nextBtn.addClass("disabled"),this.prevBtn.removeClass("disabled")):(this.nextBtn.removeClass("disabled"),this.prevBtn.removeClass("disabled")))},getIndexOf:function(t){var s=0;return i(this.groupData).each(function(i){return s=i,this.id===t?!1:void 0}),s},initPopup:function(i){var t=i.attr("data-source"),s=i.attr("data-id");this.showMaskAndPoupup(t,s)},getGroup:function(){var t=this,s=this.bodyNode.find("*[data-group="+this.groupName+"]");t.groupData.length=0,s.each(function(){t.groupData.push({src:i(this).attr("data-source"),id:i(this).attr("data-id"),caption:i(this).attr("data-caption")})}),console.log(t.groupData)},renderDOM:function(){var i='<div class="lightbox-pic-view"><span class="lightbox-btn lightbox-prev-btn ">  </span><img class="lightbox-image" src="images/1.jpg" ><span class="lightbox-btn lightbox-next-btn ">  </span></div><div class="lightbox-pic-caption"><div class="lightbox-caption-area"><p class="lightbox-pic-desc">图片标题</p><span class="lightbox-of-index">当前索引：1 of 4</span></div><span class="lightbox-btn-close"></span></div>';this.popupWin.html(i),this.bodyNode.append(this.popupMask,this.popupWin)}},window.LightBox=t}(jQuery);